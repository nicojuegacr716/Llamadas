<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Llamada P2P WebRTC</title>
</head>
<body>
  <h2>Conectando llamada...</h2>
  <audio id="remoteAudio" autoplay></audio>

  <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
  <script>
    const remoteAudio = document.getElementById('remoteAudio');

    // Cambia esto para distinguir entre host y cliente
    const isHost = confirm("¿Eres el host?");

    // Si eres el host, usa un ID fijo. Si no, genera uno automáticamente
    const myPeer = new Peer(isHost ? 'host-id' : undefined, {
      debug: 2
    });

    navigator.mediaDevices.getUserMedia({ audio: true, video: false }).then(stream => {
      myPeer.on('open', id => {
        console.log('Mi ID:', id);

        if (!isHost) {
          // Si no soy el host, llamo al host
          const call = myPeer.call('host-id', stream);
          call.on('stream', remoteStream => {
            remoteAudio.srcObject = remoteStream;
          });

          call.on('error', err => console.error('Error en la llamada:', err));
        }
      });

      // Si soy el host, contesto las llamadas
      myPeer.on('call', call => {
        call.answer(stream);
        call.on('stream', remoteStream => {
          remoteAudio.srcObject = remoteStream;
        });
        call.on('error', err => console.error('Error al recibir la llamada:', err));
      });

    }).catch(err => {
      console.error('Error accediendo al micrófono:', err);
    });
  </script>
</body>
</html>
